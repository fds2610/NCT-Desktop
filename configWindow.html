<!DOCTYPE html>
<html lang="de">
<head>
	<title>Config NCT Tray Notifier</title>
	<meta http-equiv="Content-Security-Policy" content="default-src 'unsafe-inline'" >
	<style>
		.invis {
			display: none;
		}
		fieldset { 
			border: none;
			padding: 0;
		}
		ul { 
			padding-inline-start: 0px;
			margin: 0px;
		}
		li { list-style-type: none; }
	</style>
	<script>
		const electron = require('electron');
		const {ipcRenderer} = electron;
		function changeVal(i,v){
//			console.log(i + ' : ' + v);
			const {ipcRenderer} = require('electron');
			let newcontent = btoa(document.getElementById('ncurl').value);
			ipcRenderer.send('serverChange', newcontent );
			console.log("serverChange: " + newcontent);
		}
		function changeOpt(i,v,c){
			//console.log(i + ' : ' + v + ' : ' + c);
			const {ipcRenderer} = require('electron');
			//let newcontent = i+'_'+v+':'+c;
			let newcontent = "";
			var x = document.getElementsByName("option");
			var i;
			console.log(x.length);
			for (i = 0; i < x.length; i++) {
				if (x[i].type == "checkbox") {
					console.log(i);
					newcontent = newcontent + x[i].value + ':' + x[i].checked + "\n";
				}
			} 
			ipcRenderer.send('optionChange', newcontent );
		}
		function connectServer() {
			const {ipcRenderer} = require('electron');
			ipcRenderer.send('connectServer', '' );
			console.log("sent IPC");
			myWinRef = window.self;
			//alert(document.getElementById('ncurl').value);
			myWinRef.close();
		}
	</script>
</head>
<body>
<div>
	<form id="configList">
	<h3>Config Settings</h3>
	<label>&nbsp;Nextcloud base url</label>&nbsp;
	<input type="text" size="30" id="ncurl" onchange="changeVal(this.id,this.value);" autofocus>&nbsp;
	<input type="submit" id="connect" onclick="connectServer();" value="Connect..."></input><br><br>
	<hr style="width:80%"></hr>
  <h3>check your options</h3> 
  <fieldset>
    <ul>
      <li class="in-vis"> 
        <label>
          <input type="checkbox" name="option" value="browser" onchange="changeOpt(this.name,this.value,this.checked);" >
          use external default browser instead of built-in chromium
        </label>
      </li>
      <li class="in-vis"> 
        <label>
           <input type="checkbox" name="option" value="base-url" onchange="changeOpt(this.name,this.value,this.checked);">
           default to NC-Talk instead of base URL
        </label>
      </li>
      <li>  
        <label>
          <input type="checkbox" name="option" value="debug" onchange="changeOpt(this.name,this.value,this.checked);">
          activate debug mode
        </label>
      </li>
    </ul> 
  </fieldset> 
	</form>
	
</div>
<script>

		console.log("Neu laden!");
		let arg = ipcRenderer.sendSync('initServerUrl', 'connection' );
		console.log(arg);
		CV = arg.split(':');
		document.getElementById('ncurl').value = atob(CV[0]);
		// set options
		var x = document.getElementsByName("option");
		var i;
		for (i = 0; i < x.length; i++) {
			if (x[i].value == 'debug' && CV[1] == 'true') { x[i].checked = true ; }
			if (x[i].value == 'browser' && CV[2] == 'true') { x[i].checked = true ; }
			if (x[i].value == 'base-url' && CV[3] == 'true') { x[i].checked = true ; }
		} 

		//document.getElementById('ncuser').value = atob(CV[1]);
		//document.getElementById('ncpwd').value = atob(CV[2]);

</script>
</body>
</html>
